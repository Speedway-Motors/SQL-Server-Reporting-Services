-- SMIHD-3016 - 12 Month Sales for all IMCA SKUs

-- SKUs in SOP or tng that contain IMCA somewhere in their description
SELECT ixSKU, sDescription, 0 as Sales12Mo
into [SMITemp].dbo.PJC_SMIHD_3016_IMCA_SKUs   
FROM (
            -- tng 
            select ixSKU COLLATE SQL_Latin1_General_CP1_CS_AS as ixSKU, 
                   sSKUDescription COLLATE SQL_Latin1_General_CP1_CS_AS as sDescription                                       -- 280
                from openquery([TNGREADREPLICA], '
                
            select ixSOPSKU  as ixSKU, 
                sSKUVariantName  as sSKUDescription
            from tblskuvariant
            where sSKUVariantName like ''%IMCA''
                                   ')        
       UNION -- 1460  
            -- SMI reporting                    
            select ixSKU, sDescription
            from tblSKU
            where sDescription LIKE '%IMCA%'   -- 1186
            and flgDeletedFromSOP = 0    
    ) X


SELECT * FROM [SMITemp].dbo.PJC_SMIHD_3016_IMCA_SKUs  

-- 12 month sales
          (SELECT AMS.ixSKU
                , SUM(AMS.AdjustedQTYSold) AS YTDQTYSold
		   FROM vwAdjustedDailySKUSales AMS -- view is based on SHIPPED DATE
           WHERE AMS.dtDate >= DATEADD(mm, DATEDIFF(mm,0,getdate())-12, 0) -- 12 months ago
             AND AMS.dtDate < getdate() -- previous month
           GROUP BY AMS.ixSKU
          ) S          
          
          
update T 
set Sales12Mo = S.Sales12Mo
from [SMITemp].dbo.PJC_SMIHD_3016_IMCA_SKUs T
 join     (SELECT AMS.ixSKU
                , SUM(AMS.AdjustedQTYSold) AS Sales12Mo
		   FROM vwAdjustedDailySKUSales AMS -- view is based on SHIPPED DATE
           WHERE AMS.dtDate >= DATEADD(mm, DATEDIFF(mm,0,getdate())-12, 0) -- 12 months ago
             AND AMS.dtDate < getdate() -- previous month
           GROUP BY AMS.ixSKU
          ) S   on T.ixSKU = S.ixSKU


SELECT * FROM [SMITemp].dbo.PJC_SMIHD_3016_IMCA_SKUs  
ORDER BY Sales12Mo


update A 
set COLUMN = B.COLUMN,
   NEXTCOLUMN = B.NEXTCOLUMN
from FIRSTTABLE A
 join SECONDTABLE B on A.XXX = B.XXX

                  
SELECT * FROM tblSKU 
where ixSKU in ('10624934','2490PB','2470DPB','25850084510S','25850084520S','25850084530S','25850084540S','25850084710S','25850084720S','25850084730S','25850084740S','25850085010S','25850085020S',
'25850085030S','25850085040S','25850184510S','25850184520S','25850184530S','25850184540S','25850184710S','25850184720S','25850184730S','25850184740S','25850185010S','25850185020S','25850185030S','25850185040S','25852084510',
'25852084520','25852084530','25852084540','25852084710','25852085010','25852184510','25852184520','25852184530','25852184540','25852184710','25852185010','25852284510','25852284520','25852284530','25852284540','25852284710',
'25852285010','25852984510BLK','25852984510BLU','25852984510GOL','25852984510GRN','25852984510ORG','25852984510PIN','25852984510PUR','25852984510RED','25852984520BLK','25852984520BLU','25852984520GOL','25852984520GRN',
'25852984520ORG','25852984520PIN','25852984520PUR','25852984520RED','25852984530BLK','25852984530BLU','25852984530GOL','25852984530GRN','25852984530ORG','25852984530PIN','25852984530PUR','25852984530RED','25852984540BLK',
'25852984540BLU','25852984540GOL','25852984540GRN','25852984540ORG','25852984540PIN','25852984540PUR','25852984540RED','25852984710BLK','25852984710BLU','25852984710GOL','25852984710GRN','25852984710ORG','25852984710PIN',
'25852984710PUR','25852984710RED','25852984720BLK','25852984720BLU','25852984720GOL','25852984720GRN','25852984720ORG','25852984720PIN','25852984720PUR','25852984720RED','25852984730BLK','25852984730BLU','25852984730GOL',
'25852984730GRN','25852984730ORG','25852984730PIN','25852984730PUR','25852984730RED','25852984740BLK','25852984740BLU','25852984740GOL','25852984740GRN','25852984740ORG','25852984740PIN','25852984740PUR','25852984740RED',
'25852985010BLK','25852985010BLU','25852985010GOL','25852985010GRN','25852985010ORG','25852985010PIN','25852985010PUR','25852985010RED','25852985020BLU','25852985020GOL','25852985020GRN','25852985020ORG','25852985020PIN',
'25852985020PUR','25852985020RED','25852985030BLU','25852985030GOL','25852985030GRN','25852985030ORG','25852985030PIN','25852985030PUR','25852985030RED','25852985040BLK','25852985040BLU','25852985040GOL','25852985040GRN',
'25852985040ORG','25852985040PIN','25852985040PUR','25852985040RED','25853980520BLK','25853980520BLU','25853980520GOL','25853980520GRN','25853980520ORG','25853980520PIN','25853980520PUR','25853980520RED','25853980530BLK',
'25853980530BLU','25853980530GOL','25853980530GRN','25853980530ORG','25853980530PIN','25853980530PUR','25853980530RED','25853980540BLK','25853980540BLU','25853980540GOL','25853980540GRN','25853980540ORG','25853980540PIN',
'25853980540PUR','25853980540RED','25853980550BLK','25853980550BLU','25853980550GOL','25853980550GRN','25853980550ORG','25853980550PIN','25853980550PUR','25853980550RED','25853984510BLK','25853984510BLU','25853984510GOL',
'25853984510GRN','25853984510ORG','25853984510PIN','25853984510PUR','25853984510RED','25853984520BLK','25853984520BLU','25853984520GOL','25853984520GRN','25853984520ORG','25853984520PIN','25853984520PUR','25853984520RED',
'25853984530BLK','25853984530BLU','25853984530GOL','25853984530GRN','25853984530ORG','25853984530PIN','25853984530PUR','25853984530RED','25853984540BLK','25853984540BLU','25853984540GOL','25853984540GRN','25853984540ORG',
'25853984540PIN','25853984540PUR','25853984540RED','25853984710BLK','25853984710BLU','25853984710GOL','25853984710GRN','25853984710ORG','25853984710PIN','25853984710PUR','25853984710RED','25853984720BLK','25853984720BLU',
'25853984720GOL','25853984720GRN','25853984720ORG','25853984720PIN','25853984720PUR','25853984720RED','25853984730BLK','25853984730BLU','25853984730GOL','25853984730GRN','25853984730ORG','25853984730PIN','25853984730PUR',
'25853984730RED','25853984740BLK','25853984740BLU','25853984740GOL','25853984740GRN','25853984740ORG','25853984740PIN','25853984740PUR','25853984740RED','25853985010BLK','25853985010BLU','25853985010GOL','25853985010GRN',
'25853985010ORG','25853985010PIN','25853985010PUR','25853985010RED','25853985020BLK','25853985020BLU','25853985020GOL','25853985020GRN','25853985020ORG','25853985020PIN','25853985020PUR','25853985020RED','25853985030BLU',
'25853985030GOL','25853985030GRN','25853985030ORG','25853985030PIN','25853985030PUR','25853985030RED','25853985040BLU','25853985040GOL','25853985040GRN','25853985040ORG','25853985040PIN','25853985040PUR','25853985040RED',
'25852985020BLK','25852985030BLK','74-7-PB-PB','74-9-PB-PB','76-7-PB-PB','76-9-PB-PB','78-7-PB-PB','78-9-PB-PB','UP46752','582PG1008I','UP1725','42036020','AUP3833','AUP4298','AUP4658')


                  