-- SMIHD-16351 - HTC Tariff Refunds Phase 2

/****************       SMI     ****************************/
SELECT IR.ixSKU, S.ixHarmonizedTariffCode, IR.ixPO, POM.ixVendor, IR.iQuantityReceived, D.dtDate 'DateReceived', IR.ixReceiver 
    -- IR.ixReceiptPointer, IR.flgPost          <-- NULL on all
    -- IR.ixLocation    <-- all were 99
INTO #ReceivedHistory -- DROP table #ReceivedHistory
FROM tblInventoryReceipt IR
    left join tblPOMaster POM on IR.ixPO = POM.ixPO
    left join tblDate D on IR.ixCreateDate = D.ixDate
    left join tblSKU S on IR.ixSKU = S.ixSKU
WHERE IR.ixCreateDate >= 18172 --  '10/01/2017'
    and POM.ixVendor in ('0099','1154','1363','2304','2404','2895','3238','3290','3415','3895','3896')
    and IR.ixSKU in ('10610200X','324962204','4702000-BLK','4702000-RED','4702000-YEL','4702005','4702124-PRP','4702136-BLK','4702224-BLK','4702224-RED','4702224-YEL','4702236-BLK','4702236-YEL','5460179K9','5502492','5505274','56052662','5606180','6172060','6172062','6172403','6172603','6172921','6172930','6172950','617318','6174025','6174031','6174043','6174045','6174075','6174129','6174133','6174143','6174244','6174279','6174298','6174330','61744110','61744113','61744120','61744123','6174919941','6176035','6176041','6176042','6176047','6176058','6176065','6176100','6176103','6178512','6178514','6178568','6178569','7024475-1-L','7024475-1-R','7024475-2','8027478','8352300542','91004003-1.1','91006372','91015600-B','91015600-P','91015840.1.CHR','91015840.1.SS','91015840.4','91015840.5','91015985-PLN','91023101','91023105','91023111','91023112','91023115','91023118','91031035-L','91031035-R','91031040','91031044-L','91031044-R','91031045-L','91031045-R','91031046-L','91031046-R','91031047-L','91031047-R','91031081','91031351','91031352','91031360','91031361','91031364','91031366','91031367-BLK','91031367-CHR','91031401','91031404','91031416','91031420','91031425','91031428','91031430','91031440','91031445','91031446','910318-7/16','91031827','91031830','91031831','91031832','91031835','91031841-3','91031842-3','91031842-4','91031843-3','91031844-3','91031845-3','91031846-3','91031846-4','91031847-3','91031847-4','9103185','91031851-3','91031851-4','91031891-3','91031891-4','91031892-3','91031892-4','91031893-3','91031893-4','91031894-3','91031894-4','91031895-3','91031895-4','91031897-3','91031898-3','91031898-4','91031981','91031983','91034306-L','91034306-R','91034425-DLX','91034443-DLX','91034446-DLX','91034448','91034457-DLX','91034902','91034904','91034927','91035140','91035141','91035143','91043540','91044754','91046.1-125','91046.1-150','91046.1-175','91047-125','91047-150','91047-175','91047-200','9104754','91048380','9104852','9105356','910615074','910616004','910616005','91062860','91064017','91064022','91064056','91064500','91064505','91064602','91065415-L','91065415-R','91065422-L','91065422-R','91065450','91065460','91065460-1','91065460-2','91078300-BLK','91078310-BLK','91078310-BLU','91078310-RED','91089150','91089210','91089405','91097701','91097704','912TLM11910','912TLM603011','91364381','9162831','91631914','91631931','91631981','91631985','91631986','91641012-L','91657010','91657011','91658000','91673010','917340-22','917340-24','917340-26','917340-28','917340-31','917341-22','917341-24','917341-26','917341-28','917341-31','9173423','9173425','917347-22','917347-24','917347-26','917347-28','917347-31','917348-22','917348-24','917348-26','917348-28','917348-31','9175026','9175064','9175070','9175072','9175159','9175160','9175161','9175163','91755581','9191563','9193381','9193382','9403420','97415986') -- 242 SKUs provided by Richard


    SELECT * FROM #ReceivedHistory

    SELECT DISTINCT ixSKU from #ReceivedHistory -- 215 SKUs

    SELECT DISTINCT ixPO from #ReceivedHistory -- 74 POs

    SELECT RH.ixSKU, SUM(iQuantityReceived) 'TotalRcvd', S.mAverageCost 
        -- (SUM(iQuantityReceived)* S.mAverageCost) 'EstExtCost'
    from #ReceivedHistory RH
        left join tblSKU S on RH.ixSKU = S.ixSKU
    group by RH.ixSKU, S.mAverageCost
    order by SUM(iQuantityReceived) desc



-- select * from tblDate where dtDate = '10/01/2017'    18172




/****************       AFCO     ****************************/
SELECT IR.ixSKU, S.ixHarmonizedTariffCode, IR.ixPO, POM.ixVendor, IR.iQuantityReceived, D.dtDate 'DateReceived', IR.ixReceiver 
    -- IR.ixReceiptPointer, IR.flgPost          <-- NULL on all
    -- IR.ixLocation    <-- all were 99
INTO #AFCOReceivedHistory -- DROP table #AFCOReceivedHistory
FROM tblInventoryReceipt IR
    left join tblPOMaster POM on IR.ixPO = POM.ixPO COLLATE SQL_Latin1_General_CP1_CI_AS
    left join tblDate D on IR.ixCreateDate = D.ixDate
    left join tblSKU S on IR.ixSKU = S.ixSKU
WHERE IR.ixCreateDate >= 18172 --  '10/01/2017'
    and POM.ixVendor in ('5023','5118','5558','5631','5727','5918','6125','6167','6361','6379','6458','6687','7448','7462','7484','7522','7551','7552','7556','7558','7561','7572','7573','7577','7582','7595','7615','7623','7624','7626','7628','7652','7657','7658','7668','7680','7692','7709','7711','7713','7717','7719','7766','8085')
    and IR.ixSKU in ('52-902395','52-901451','52-905509','52-904237','0000973.02','52-904348','52-900318','52-903780','52-904773','52-901452','0000973.04','52-905034','52-901360','52-900313','52-905431','52-902358','52-903026','A901040009X','52-905804','52-905325','52-900090','80101X-1','52-905130','A901040007X','52-905319','52-904797','52-902103','52-904349','52-905618','1001205','52-905322','80101X-7','52-905165','52-905166','52-902848','52-905084','52-904399','7242-2904-X','52-905186','80101X-2','52-901361','52-905891','80101X10','52-904693','7242-2903-X','52-905892','52-904692','52-900663','52-902394','52-903265','52-903341','80168X-1','0000973.03','52-905085','52-904350','52-905698','0000973.01','52-901483') -- 58 SKUs provided by Richard



    SELECT * FROM tblSKU where ixSKU in ('52-902395','52-901451','52-905509','52-904237','0000973.02','52-904348','52-900318','52-903780','52-904773','52-901452','0000973.04','52-905034','52-901360','52-900313','52-905431','52-902358','52-903026','A901040009X','52-905804','52-905325','52-900090','80101X-1','52-905130','A901040007X','52-905319','52-904797','52-902103','52-904349','52-905618','1001205','52-905322','80101X-7','52-905165','52-905166','52-902848','52-905084','52-904399','7242-2904-X','52-905186','80101X-2','52-901361','52-905891','80101X10','52-904693','7242-2903-X','52-905892','52-904692','52-900663','52-902394','52-903265','52-903341','80168X-1','0000973.03','52-905085','52-904350','52-905698','0000973.01','52-901483')
    
    SELECT * FROM #AFCOReceivedHistory

    SELECT DISTINCT ixSKU from #AFCOReceivedHistory -- 58 SKUs

    SELECT DISTINCT ixPO from #AFCOReceivedHistory -- 98 POs


    SELECT RH.ixSKU, SUM(iQuantityReceived) 'TotalRcvd', S.mAverageCost 
        -- (SUM(iQuantityReceived)* S.mAverageCost) 'EstExtCost'
    from #AFCOReceivedHistory RH
        left join tblSKU S on RH.ixSKU = S.ixSKU
    group by RH.ixSKU, S.mAverageCost
    order by SUM(iQuantityReceived) desc